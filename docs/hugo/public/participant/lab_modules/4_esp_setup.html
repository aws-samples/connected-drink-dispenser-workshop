<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.59.1" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>4. MCU Setup &amp; Test :: Connected Drink Dispenser Workshop</title>

    
    <link href="../../css/nucleus.css" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css" rel="stylesheet">
    <link href="../../css/hybrid.css" rel="stylesheet">
    <link href="../../css/featherlight.min.css" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../../css/auto-complete.css" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css" rel="stylesheet">
    <link href="../../css/theme.css" rel="stylesheet">
    <link href="../../css/hugo-theme.css" rel="stylesheet">
    
      <link href="../../css/theme-mine.css" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <link rel="stylesheet" href="../../css/adoc.css">
<link rel="stylesheet" href="../../css/tags.css">
<link rel="stylesheet" href="../../css/jquery-ui.min.css">
  </head>
  <body class="" data-url="/participant/lab_modules/4_esp_setup.html">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://cdd.example.com/docs/docs">
    <img src="../../images/cdd_logo.png" alt="Connected Drink Dispenser Workshop" width="50%">
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js"></script>
<script type="text/javascript" src="../../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/cdd.example.com\/docs";
    
</script>
<script type="text/javascript" src="../../js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/participant.html" title="Workshop Participant" class="dd-item 
        parent
        
        
        ">
      <a href="../../participant.html">
          <i class="fas fa-user-graduate"></i>&nbsp;Workshop Participant
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules.html" title="Lab Modules" class="dd-item 
        parent
        
        
        ">
      <a href="../../participant/lab_modules.html">
          <i class="fas fa-user-graduate"></i>&nbsp;Lab Modules
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/1_overview.html" title="1. Architecture Overview" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/1_overview.html">
          1. Architecture Overview
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/2_laptop_setup.html" title="2. Laptop Setup" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/2_laptop_setup.html">
          2. Laptop Setup
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/3_create_account.html" title="3. Create Account/Resources" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/3_create_account.html">
          3. Create Account/Resources
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/4_esp_setup.html" title="4. MCU Setup &amp; Test" class="dd-item 
        parent
        active
        
        ">
      <a href="../../participant/lab_modules/4_esp_setup.html">
          4. MCU Setup &amp; Test
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/5_cloud9_setup.html" title="5. Cloud9 Dev Environment" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/5_cloud9_setup.html">
          5. Cloud9 Dev Environment
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/6_flash_and_test.html" title="6. Develop, Flash, &amp; Test MCU" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/6_flash_and_test.html">
          6. Develop, Flash, &amp; Test MCU
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/7_investigate_cloud.html" title="7. Review Cloud Architecture" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/7_investigate_cloud.html">
          7. Review Cloud Architecture
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/8_build_dispenser.html" title="8. Build Dispenser" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/8_build_dispenser.html">
          8. Build Dispenser
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/participant/lab_modules/9_final_test.html" title="9. Dispense a Drink!" class="dd-item 
        
        
        
        ">
      <a href="../../participant/lab_modules/9_final_test.html">
          9. Dispense a Drink!
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/presenter.html" title="Setting Up the Workshop" class="dd-item 
        
        
        
        ">
      <a href="../../presenter.html">
          <i class="fas fa-chalkboard-teacher"></i>&nbsp;Setting Up the Workshop
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/presenter/prerequisites.html" title="Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="../../presenter/prerequisites.html">
          <i class="fas fa-greater-than"></i>&nbsp;Prerequisites
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/presenter/deploy.html" title="Deploy Stack" class="dd-item 
        
        
        
        ">
      <a href="../../presenter/deploy.html">
          <i class="fas fa-greater-than"></i>&nbsp;Deploy Stack
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/presenter/repository.html" title="Repository Layout" class="dd-item 
        
        
        
        ">
      <a href="../../presenter/repository.html">
          <i class="fas fa-greater-than"></i>&nbsp;Repository Layout
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/presenter/design_notes.html" title="Design Notes" class="dd-item 
        
        
        
        ">
      <a href="../../presenter/design_notes.html">
          <i class="fas fa-greater-than"></i>&nbsp;Design Notes
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/presenter/design_notes/message_flows.html" title="Message Flows" class="dd-item 
        
        
        
        ">
      <a href="../../presenter/design_notes/message_flows.html">
          <i class="fas fa-greater-than"></i>&nbsp;Message Flows
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/search?q=topic%3Aiot&#43;org%3Aaws-samples&#43;fork%3Atrue"><i class='fas fa-bookmark'></i> AWS Samples on GitHub</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='../../'></a> > <a href='../../participant.html'>Workshop Participant</a> > <a href='../../participant/lab_modules.html'>Lab Modules</a> > 4. MCU Setup & Test
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#objectives">Objectives</a></li>
<li><a href="#steps-to-complete">Steps to Complete</a>
<ul>
<li><a href="#1-remove-the-components-to-use">1. Remove the Components to Use</a></li>
<li><a href="#2-connect-the-led-ring-to-the-controller-board">2. Connect the LED Ring to the Controller Board</a></li>
<li><a href="#3-install-the-microcontroller-into-the-controller-board">3. Install the Microcontroller into the Controller Board</a></li>
<li><a href="#4-connect-the-microcontroller-to-your-laptop-and-test-serial-communication">4. Connect the Microcontroller to Your Laptop and Test Serial Communication</a></li>
</ul></li>
<li><a href="#checkpoints">Checkpoints</a></li>
<li><a href="#outcomes">Outcomes</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              4. MCU Setup &amp; Test
            </h1>
          

        




	

<h2 id="objectives">Objectives</h2>

<p>This lab module will walk you through connecting the components to test the operation of the dispenser without having to build the entire dispenser at this time.</p>

<p>By the end of this module you will have:</p>

<ul>
<li>Installed all the components needed to test the operation of the dispenser firmware with the cloud backend.</li>
<li>Have an understanding of what each component does.</li>
<li>Be able to communicate with the microcontroller via your laptop.</li>
</ul>


<div class="notices warning" ><p>Building the dispenser takes up a lot of room. For now, just remove the parts mentioned below and leave the rest in the zip-top bag. Promise: You <em>will</em> build entire dispenser in a bit!</p>
</div>


<p>The LED Ring is controlled by the microprocessor, and is used to denote the status of the overall application. It is powered and controlled by microcontroller and the firmware you will compile and flash.</p>

<p>The Controller Board serves a few functions.</p>

<ul>
<li>It acts as carrier for microcontroller, and provides easy to use connectors for the other components being connected such as the LED Ring, external power, and the aquarium motor which will be installed later.</li>
<li>It allows for either USB provided power to test (however there is not enough power to active the motor), or can be powered by an external battery, such as the 9V provided.</li>
<li>It also helps anchor all the components into the final design build while still providing access.</li>
</ul>

<h2 id="steps-to-complete">Steps to Complete</h2>

<p>Follow each step in order and use the <em>Click to open for detailed step-by-step instructions</em> if required.</p>

<h3 id="1-remove-the-components-to-use">1. Remove the Components to Use</h3>

<p>Remove these four components from the zip-top bag (you should already have the ESP32 microcontroller and USB cable out from earlier testing):</p>

<ul>
<li>ESP32 Microcontroller</li>
<li>Controller Board</li>
<li>Ring LED</li>
<li>USB Cable (Type-A to Micro USB data and power)</li>
</ul>

<p><img src="../../images/lab4_components.png" alt="Components" height="400"/></p>

<h3 id="2-connect-the-led-ring-to-the-controller-board">2. Connect the LED Ring to the Controller Board</h3>

<p>Install the LED Ring into the <code>WS2812</code> 3-pin connector on the Controller Board with the tab aligned with the connector slot.</p>

<p><img src="../../images/lab4_led_connected.png" alt="Connecting LED Ring to Controller" height="400"/></p>


<div class="expand">
    <div class="expand-label" style="cursor: pointer;text-decoration: underline" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-circle-down' : 'fas fa-chevron-circle-right';});});">
        <i style="font-size:large;" class="fas fa-chevron-circle-right"></i>
        <span>
        
    	
    	Click to open for detailed step-by-step instructions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <ol>
<li>Hold the LED Ring cable&rsquo;s connector between your fingers.</li>
<li>Align the tab on the connector with the slot on the 3-pin <code>WS2812</code> labeled receptacle on the Controller Board.</li>
<li>With slight pressure, insert the connector until it is fully in.</li>
</ol>

    </div>
</div>

<h3 id="3-install-the-microcontroller-into-the-controller-board">3. Install the Microcontroller into the Controller Board</h3>

<p>Align the microcontroller into the dual inline socket on the other side of the Controller Board, aligning the large metal square package with the <code>Motor A Motor B</code> text on the controller board. Make sure all pins on the ESP32 and the socket, then gently insert until all the way in.</p>

<p><img src="../../images/lab4_insert_esp32.png" alt="Inserting ESP32 into Controller Board" height="400"/></p>


<div class="notices tip" ><p>It is very easy to accidentally bend the pins on the microcontroller. Turn over the Controller Board with the socket facing up, and then with your other hand gently position the microcontroller pins into the holes. Once all are in place, gently apply pressure equally (center of microcontroller works best) to insert all the way in. If you accidentally install backwards, place a finger <em>underneath</em> one end of the microcontroller and apply pressure to lift slightly. The do the same on the other end and alternate back and forth until the microcontroller is out of the socket.</p>
</div>



<div class="expand">
    <div class="expand-label" style="cursor: pointer;text-decoration: underline" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-circle-down' : 'fas fa-chevron-circle-right';});});">
        <i style="font-size:large;" class="fas fa-chevron-circle-right"></i>
        <span>
        
    	
    	Click to open for detailed step-by-step instructions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <ol>
<li>Hold the Controller Board in one hand with the socket side (opposite of the LED Ring connection) facing up.</li>
<li>In your other hand hold the microcontroller and align the side with the large metal side with tab (antenna) to the Controller Board with <code>Motor A Motor B</code> text.</li>
<li>Align the pins on the microcontroller to the socket and lightly place. Ensure each pin is in a hole.
<img src="../../images/lab4_side_not_flush.png" alt="ESP32 Aligned, not Plugged In" height="400"/></li>
<li>With gentle, even pressure, press the microcontroller in the socket until flush.
<img src="../../images/lab4_side_flush.png" alt="ESP32 Aligned, Fully Inserted" width="600"/></li>
</ol>

    </div>
</div>

<h3 id="4-connect-the-microcontroller-to-your-laptop-and-test-serial-communication">4. Connect the Microcontroller to Your Laptop and Test Serial Communication</h3>

<p>Insert the USB cable&rsquo;s Micro USB connector into the end of the microcontroller, and the Type-A connector into your laptop. The red LED on the microcontroller indicates power, and the LED Ring <em>may</em> light up. Next, check that the serial port tested in the <em>Laptop Setup</em> module is there. Next, use the serial monitoring software to connect to the serial port. Press the button to the left of the USB connection and verify you see text after each press. Exit your monitoring software.</p>

<p><img src="../../images/lab4_plugged_in.png" alt="Controller Plugged In" height="400"/></p>


<div class="notices info" ><p>A Micro USB to Type-A cable was provided. If your laptop only has Type-C connector and you have a Micro USB to Type-C cable, make sure that it supports <em>both</em> power and data connections. The workshop presenter may have Micro USB to Type-C cables to loan out.</p>
</div>



<div class="expand">
    <div class="expand-label" style="cursor: pointer;text-decoration: underline" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-circle-down' : 'fas fa-chevron-circle-right';});});">
        <i style="font-size:large;" class="fas fa-chevron-circle-right"></i>
        <span>
        
    	
    	Click to open for detailed step-by-step instructions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <ol>
<li>Insert the USB cable into the microcontroller, and then your laptop and verify that is had power via the red LED on the microcontroller.</li>
<li>Use the serial monitoring tool to verify that the same serial port for your laptop still works. In some cases, especially in Windows, this value may change on each connection or if you use a different serial port.</li>

<li><p>Press the button to the left of the USB connection and verify you see text after each press. It should look similar to this:</p>

<pre><code>rst:0x1 (POWERON_RESET),boot:0x13 (SPI_FAST_FLASH_BOOT)
configsip: 0, SPIWP:0xee
clk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00
mode:DIO, clock div:2
load:0x3fff0018,len:4
load:0x3fff001c,len:6340
load:0x40078000,len:11276
load:0x40080000,len:6084
entry 0x4008032c
I (28) boot: ESP-IDF v3.1.3-13-g44a799c47 2nd stage bootloader
I (28) boot: compile time 18:50:42
I (28) boot: Enabling RNG early entropy source...
I (34) boot: SPI Speed      : 40MHz
I (38) boot: SPI Mode       : DIO
I (42) boot: SPI Flash Size : 4MB
I (46) boot: Partition Table:
</code></pre></li>

<li><p>Exit the monitoring program. You may leave the microcontroller attached if you like.</p></li>
</ol>

    </div>
</div>

<h2 id="checkpoints">Checkpoints</h2>

<p>Please ensure the following checkpoints are validated before moving on to the next module.</p>

<ol>
<li>The LED Ring and microcontroller are connected to the Controller Board.</li>
<li>The microcontroller has power when connected to your laptop.</li>
<li>You can see text via the serial monitoring tool.</li>
</ol>

<h2 id="outcomes">Outcomes</h2>

<p>So why are we only installing a few pieces of the entire dispenser instead of building now? When doing embedded software development, it is easier to work with a development microcontroller kit and the accessories you will be controlling. Normally this would be done with a breadboard or some other development kit (devkit). However, for those that are not familiar with that process, using the minimum pieces now will allow us to continue testing up until we do incorporate the components into the overall dispenser.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../participant/lab_modules/3_create_account.html" title="3. Create Account/Resources"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../participant/lab_modules/5_cloud9_setup.html" title="5. Cloud9 Dev Environment" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js"></script>
    <script src="../../js/perfect-scrollbar.min.js"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../../js/jquery.sticky.js"></script>
    <script src="../../js/featherlight.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js"></script>
    <script src="../../js/learn.js"></script>
    <script src="../../js/hugo-learn.js"></script>

    <link href="../../mermaid/mermaid.css" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <div style="float: right;margin-right: 10px;margin-top: 10px;font-size: smaller;">Copyright Â© 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.</div>

<script src="../../js/fix-adoc.js"></script>
<script src="../../js/jquery-ui.min.js"></script>

  </body>
</html>
